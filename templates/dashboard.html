<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDEWS - Earthquake Dashboard</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
        }

        .header-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .header-stat .label {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .refresh-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .refresh-btn:hover {
            background: white;
            color: #667eea;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            height: calc(100vh - 80px);
            gap: 0;
        }

        .map-container {
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .sidebar {
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .right-sidebar {
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-left: 1px solid #e0e0e0;
        }

        .right-sidebar-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .right-sidebar-header h3 {
            margin: 0;
            font-size: 1.1em;
            color: #333;
        }

        .filter-tabs {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .filter-tab {
            padding: 6px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
        }

        .filter-tab:hover {
            background: #e9ecef;
        }

        .filter-tab.active:hover {
            background: #5568d3;
        }

        .alerts-list, .news-list, .earthquake-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .earthquake-list h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
            padding: 0 10px;
        }

        .earthquake-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            cursor: pointer;
            transition: all 0.2s;
        }

        .earthquake-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .earthquake-item.strong {
            border-left-color: #e74c3c;
            background: #fee;
        }

        .eq-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .eq-magnitude {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .eq-magnitude.strong {
            color: #e74c3c;
        }

        .eq-location {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .eq-time {
            font-size: 0.85em;
            color: #999;
        }

        .regions-panel {
            padding: 15px 10px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .regions-panel h3 {
            font-size: 1em;
            color: #333;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .region-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            margin-bottom: 5px;
            background: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .region-name {
            color: #666;
        }

        .region-count {
            font-weight: 600;
            color: #667eea;
        }

        .alert-item, .news-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-item:hover, .news-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .alert-item.high {
            border-left-color: #e74c3c;
            background: #fee;
        }

        .alert-item.medium {
            border-left-color: #f39c12;
            background: #fff4e6;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .alert-title {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .alert-date {
            font-size: 0.8em;
            color: #999;
        }

        .alert-message {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .alert-section-header {
            font-size: 1.1em;
            font-weight: 600;
            color: #667eea;
            margin: 20px 0 10px 0;
            padding: 10px;
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }

        .alert-section-header:first-child {
            margin-top: 0;
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 5px;
        }

        .news-title {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
            flex: 1;
        }

        .news-source {
            font-size: 0.75em;
            color: #667eea;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 8px;
        }

        .news-time {
            font-size: 0.75em;
            color: #999;
            margin-top: 5px;
        }

        .weather-details-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 20px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .weather-details-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .weather-details-header h3 {
            margin: 0;
            color: #667eea;
            font-size: 1.2em;
        }

        .weather-city-detail {
            padding: 15px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .weather-city-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .weather-metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .weather-metric:last-child {
            border-bottom: none;
        }

        .weather-metric-label {
            color: #666;
            font-size: 0.9em;
        }

        .weather-metric-value {
            font-weight: 600;
            color: #333;
        }

        .stats-panel {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stat-card.max {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .stat-card.avg {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .stat-card.min {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .earthquake-list {
            flex: 1;
            overflow-y: auto;
            background: white;
            padding: 20px;
        }

        .earthquake-list h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .earthquake-item {
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            border-radius: 5px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .earthquake-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .earthquake-item.strong {
            border-left-color: #e74c3c;
            background: #fee;
        }

        .eq-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .eq-magnitude {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .eq-magnitude.strong {
            color: #e74c3c;
        }

        .eq-location {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
            margin-bottom: 3px;
        }

        .eq-time {
            color: #999;
            font-size: 0.85em;
        }

        .regions-panel {
            background: white;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            max-height: 250px;
            overflow-y: auto;
        }

        .regions-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .region-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .region-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .region-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .legend h4 {
            margin-bottom: 10px;
            color: #333;
            font-size: 0.95em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid rgba(0,0,0,0.2);
        }

        .legend-color.small { background: #27ae60; }
        .legend-color.medium { background: #f39c12; }
        .legend-color.large { background: #e74c3c; }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        /* Draggable Weather Window */
        .weather-window {
            position: absolute;
            top: 100px;
            right: 20px;
            width: 400px;
            max-height: 600px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .weather-window.active {
            display: flex;
        }

        .weather-window-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .weather-window-header h3 {
            margin: 0;
            font-size: 1.2em;
            font-weight: 600;
        }

        .weather-window-controls {
            display: flex;
            gap: 10px;
        }

        .weather-window-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.2s;
        }

        .weather-window-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .weather-window-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            max-height: calc(600px - 60px);
        }

        .weather-city-card {
            padding: 15px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.2s;
            cursor: pointer;
        }

        .weather-city-card:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .weather-city-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .weather-city-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .weather-city-temp {
            font-size: 1.6em;
            font-weight: bold;
        }

        .weather-city-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.9em;
        }

        .weather-detail-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }

        .weather-detail-label {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .weather-detail-value {
            font-weight: bold;
            color: #333;
        }

        .weather-toggle-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s;
        }

        .weather-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>SDEWS - Smart Disaster Early Warning System</h1>
        </div>
        <div class="header-info">
            <div class="header-stat">
                <div class="value" id="header-total">-</div>
                <div class="label">Toplam Deprem</div>
            </div>
            <div class="header-stat">
                <div class="value" id="header-max">-</div>
                <div class="label">En BÃ¼yÃ¼k</div>
            </div>
            <button class="refresh-btn" onclick="loadData()">Yenile</button>
        </div>
    </div>

    <div class="main-content">
        <!-- Merkez - Harita ve Hava Durumu -->
        <div class="map-container">
            <div id="map"></div>
            <button class="weather-toggle-btn" onclick="toggleWeatherWindow()">Hava Durumu</button>
            <div class="weather-window" id="weatherWindow">
                <div class="weather-window-header" id="weatherWindowHeader">
                    <h3>Hava Durumu</h3>
                    <div class="weather-window-controls">
                        <button class="weather-window-btn" onclick="minimizeWeatherWindow()" title="KÃ¼Ã§Ã¼lt">-</button>
                        <button class="weather-window-btn" onclick="toggleWeatherWindow()" title="Kapat">Ã—</button>
                    </div>
                </div>
                <div class="weather-window-body" id="weatherWindowBody">
                    <div class="loading">YÃ¼kleniyor...</div>
                </div>
            </div>
            <div class="weather-details-panel" id="weatherDetailsPanel" style="display: none;">
                <div class="weather-details-header">
                    <h3>Hava Durumu DetaylarÄ±</h3>
                </div>
                <div id="weatherDetailsContent"></div>
            </div>
            <div class="legend">
                <h4>Deprem BÃ¼yÃ¼klÃ¼ÄŸÃ¼</h4>
                <div class="legend-item">
                    <div class="legend-color large"></div>
                    <span>5.0+ (BÃ¼yÃ¼k)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color medium"></div>
                    <span>4.0 - 4.9 (Orta)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color small"></div>
                    <span>2.5 - 3.9 (KÃ¼Ã§Ã¼k)</span>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <h4 style="margin-bottom: 10px; font-size: 0.95em;">Hava Durumu</h4>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #e74c3c; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>25Â°C+ (Ã‡ok SÄ±cak)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #f39c12; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>20-24Â°C (SÄ±cak)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #f1c40f; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>15-19Â°C (IlÄ±k)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #3498db; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>10-14Â°C (Serin)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #3498db; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>5-9Â°C (SoÄŸuk)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 15px; height: 15px; background: #2c3e50; border-radius: 3px; margin-right: 8px; display: inline-block;"></div>
                        <span>&lt;5Â°C (Ã‡ok SoÄŸuk)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SaÄŸ Sidebar - Alerts ve News -->
        <div class="right-sidebar">
            <div class="right-sidebar-header">
                <h3 id="rightSidebarTitle">UyarÄ±lar ve Haberler</h3>
                <span id="rightSidebarDate"></span>
            </div>
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterContent('earthquakes')">Depremler</button>
                <button class="filter-tab" onclick="filterContent('alerts')">Mevcut UyarÄ±lar</button>
                <button class="filter-tab" onclick="filterContent('forecast')">Ä°leriye DÃ¶nÃ¼k</button>
                <button class="filter-tab" onclick="filterContent('news')">Haberler</button>
            </div>
            <div class="earthquake-list" id="earthquakeList">
                <div class="loading">YÃ¼kleniyor...</div>
            </div>
            <div class="alerts-list" id="alertsList" style="display: none;">
                <div class="loading">YÃ¼kleniyor...</div>
            </div>
            <div class="alerts-list" id="forecastAlertsList" style="display: none;">
                <div class="loading">YÃ¼kleniyor...</div>
            </div>
            <div class="news-list" id="newsList" style="display: none;">
                <div class="loading">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Harita baÅŸlat - TÃ¼rkiye'ye odaklan
        const map = L.map('map').setView([39.0, 35.0], 6);

        // OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        let earthquakeMarkers = [];
        let weatherMarkers = [];

        function getMarkerColor(magnitude) {
            if (magnitude >= 5.0) return '#e74c3c';  // KÄ±rmÄ±zÄ±
            if (magnitude >= 4.0) return '#f39c12';  // Turuncu
            return '#27ae60';  // YeÅŸil
        }

        function getMarkerSize(magnitude) {
            if (magnitude >= 5.0) return 12;
            if (magnitude >= 4.0) return 9;
            return 7;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('tr-TR');
        }

        function clearMarkers() {
            earthquakeMarkers.forEach(marker => map.removeLayer(marker));
            earthquakeMarkers = [];
            weatherMarkers.forEach(marker => map.removeLayer(marker));
            weatherMarkers = [];
        }

        function getTemperatureColor(temp) {
            if (temp >= 25) return '#e74c3c';  // KÄ±rmÄ±zÄ± - Ã‡ok sÄ±cak
            if (temp >= 20) return '#f39c12';  // Turuncu - SÄ±cak
            if (temp >= 15) return '#f1c40f';  // SarÄ± - IlÄ±k
            if (temp >= 10) return '#3498db';  // Mavi - Serin
            if (temp >= 5) return '#3498db';   // Mavi - SoÄŸuk
            return '#2c3e50';  // Koyu mavi - Ã‡ok soÄŸuk
        }

        function addWeatherMarker(weather) {
            if (!weather.latitude || !weather.longitude) return;
            
            const temp = weather.temperature || 0;
            const color = getTemperatureColor(temp);
            
            // Ã–zel ikon oluÅŸtur - sadece sÄ±caklÄ±k deÄŸeri
            const weatherIcon = L.divIcon({
                className: 'weather-marker',
                html: `
                    <div style="
                        background: ${color};
                        border: 3px solid white;
                        border-radius: 50%;
                        width: 45px;
                        height: 45px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                        cursor: pointer;
                    ">
                        <span style="
                            color: white;
                            font-weight: bold;
                            font-size: 12px;
                        ">${temp.toFixed(0)}Â°</span>
                    </div>
                `,
                iconSize: [45, 45],
                iconAnchor: [22, 22],
                popupAnchor: [0, -22]
            });

            const marker = L.marker([weather.latitude, weather.longitude], {
                icon: weatherIcon
            }).addTo(map);

            // Bulut, yaÄŸÄ±ÅŸ ve nem bilgilerini hazÄ±rla
            const clouds = weather.clouds || 0;
            const humidity = weather.humidity || 0;
            const precipitation = weather.precipitation || 0;
            const pressure = weather.pressure || 0;
            const visibility = weather.visibility ? (weather.visibility / 1000).toFixed(1) : '-';
            
            marker.bindPopup(`
                <div style="min-width: 250px; padding: 10px;">
                    <h3 style="margin: 0 0 15px 0; color: ${color}; font-size: 1.4em; text-align: center; border-bottom: 2px solid ${color}; padding-bottom: 8px;">
                        ${weather.location || 'Bilinmeyen'}
                    </h3>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 2.5em; font-weight: bold; color: ${color}; margin-bottom: 5px;">
                            ${temp.toFixed(1)}Â°C
                        </div>
                        ${weather.feels_like ? `
                        <div style="font-size: 0.9em; color: #666;">
                            Hissedilen: ${weather.feels_like.toFixed(1)}Â°C
                        </div>
                        ` : ''}
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em; margin-bottom: 10px;">
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 5px; font-weight: 600;">RÃ¼zgar</div>
                            <div style="font-weight: bold; color: #3498db; font-size: 1.1em;">
                                ${weather.wind_speed ? weather.wind_speed.toFixed(1) : '-'} m/s
                            </div>
                            ${weather.wind_direction ? `
                            <div style="font-size: 0.75em; color: #999; margin-top: 3px;">
                                ${weather.wind_direction}Â°
                            </div>
                            ` : ''}
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 5px; font-weight: 600;">Nem</div>
                            <div style="font-weight: bold; color: #3498db; font-size: 1.1em;">
                                ${humidity}%
                            </div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 5px; font-weight: 600;">Bulutluluk</div>
                            <div style="font-weight: bold; color: #3498db; font-size: 1.1em;">
                                ${clouds}%
                            </div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 5px; font-weight: 600;">YaÄŸÄ±ÅŸ</div>
                            <div style="font-weight: bold; color: #3498db; font-size: 1.1em;">
                                ${precipitation > 0 ? precipitation.toFixed(1) + ' mm' : 'Yok'}
                            </div>
                        </div>
                    </div>
                    ${pressure > 0 ? `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em; margin-bottom: 10px;">
                        <div style="text-align: center; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 3px;">BasÄ±nÃ§</div>
                            <div style="font-weight: bold; color: #3498db;">
                                ${pressure.toFixed(0)} hPa
                            </div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.8em; margin-bottom: 3px;">GÃ¶rÃ¼ÅŸ</div>
                            <div style="font-weight: bold; color: #3498db;">
                                ${visibility} km
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    ${weather.time ? `
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0; text-align: center; font-size: 0.85em; color: #999;">
                        ${formatTime(weather.time)}
                    </div>
                    ` : ''}
                </div>
            `);
            
            // Marker'a tÄ±klandÄ±ÄŸÄ±nda haritayÄ± zoomla
            marker.on('click', function() {
                map.setView([weather.latitude, weather.longitude], 10);
            });

            weatherMarkers.push(marker);
            return marker;
        }

        function addEarthquakeMarker(eq) {
            const color = getMarkerColor(eq.magnitude);
            const size = getMarkerSize(eq.magnitude);

            const marker = L.circleMarker([eq.latitude, eq.longitude], {
                radius: size,
                fillColor: color,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            marker.bindPopup(`
                <div style="min-width: 200px;">
                    <h3 style="margin: 0 0 10px 0; color: ${color}; font-size: 1.3em;">
                        Magnitude ${eq.magnitude}
                    </h3>
                    <p style="margin: 5px 0;"><strong>Lokasyon:</strong><br>${eq.location}</p>
                    <p style="margin: 5px 0;"><strong>Zaman:</strong><br>${formatTime(eq.timestamp)}</p>
                    <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                        ${eq.latitude.toFixed(4)}, ${eq.longitude.toFixed(4)}
                    </p>
                </div>
            `);

            earthquakeMarkers.push(marker);

            // Liste itemine tÄ±klanÄ±nca haritada gÃ¶ster
            return marker;
        }

        // Draggable window functionality
        let isDragging = false;
        let currentX, currentY, initialX, initialY;
        let weatherWindow = null;
        let weatherWindowHeader = null;

        function initDraggable() {
            weatherWindow = document.getElementById('weatherWindow');
            weatherWindowHeader = document.getElementById('weatherWindowHeader');
            
            weatherWindowHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
        }

        function dragStart(e) {
            if (e.target.classList.contains('weather-window-btn')) return;
            initialX = e.clientX - weatherWindow.offsetLeft;
            initialY = e.clientY - weatherWindow.offsetTop;
            if (e.target === weatherWindowHeader || weatherWindowHeader.contains(e.target)) {
                isDragging = true;
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                // Ekran sÄ±nÄ±rlarÄ± iÃ§inde tut
                const maxX = window.innerWidth - weatherWindow.offsetWidth;
                const maxY = window.innerHeight - weatherWindow.offsetHeight;
                
                currentX = Math.max(0, Math.min(currentX, maxX));
                currentY = Math.max(0, Math.min(currentY, maxY));
                
                weatherWindow.style.left = currentX + 'px';
                weatherWindow.style.top = currentY + 'px';
            }
        }

        function dragEnd() {
            isDragging = false;
        }

        function toggleWeatherWindow() {
            const window = document.getElementById('weatherWindow');
            window.classList.toggle('active');
            if (window.classList.contains('active')) {
                loadWeatherWindowData();
            }
        }

        function minimizeWeatherWindow() {
            const window = document.getElementById('weatherWindow');
            const body = document.getElementById('weatherWindowBody');
            if (body.style.display === 'none') {
                body.style.display = 'block';
            } else {
                body.style.display = 'none';
            }
        }

        function loadWeatherWindowData() {
            // Hem anlÄ±k hem forecast verilerini Ã§ek
            Promise.all([
                fetch('/api/weather').then(r => r.json()),
                fetch('/api/forecast').then(r => r.json())
            ]).then(([weatherData, forecastData]) => {
                const container = document.getElementById('weatherWindowBody');
                
                if (weatherData.weather && weatherData.weather.length > 0) {
                    container.innerHTML = '';
                    
                    weatherData.weather.forEach(weather => {
                        const temp = weather.temperature || 0;
                        const color = getTemperatureColor(temp);
                        const city = weather.location || 'Bilinmeyen';
                        
                        // Bu ÅŸehir iÃ§in forecast verilerini al
                        const cityForecasts = forecastData.forecasts && forecastData.forecasts[city] ? forecastData.forecasts[city] : [];
                        
                        const card = document.createElement('div');
                        card.className = 'weather-city-card';
                        card.onclick = () => {
                            if (weather.latitude && weather.longitude) {
                                map.setView([weather.latitude, weather.longitude], 8);
                                // Ä°lgili marker'Ä± bul ve popup aÃ§
                                weatherMarkers.forEach(marker => {
                                    const lat = marker.getLatLng().lat;
                                    const lng = marker.getLatLng().lng;
                                    if (Math.abs(lat - weather.latitude) < 0.1 && 
                                        Math.abs(lng - weather.longitude) < 0.1) {
                                        marker.openPopup();
                                    }
                                });
                            }
                        };
                        
                        // Forecast timeline HTML'i oluÅŸtur
                        let forecastTimelineHTML = '';
                        if (cityForecasts.length > 0) {
                            forecastTimelineHTML = `
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                    <div style="font-size: 0.9em; font-weight: 600; color: #667eea; margin-bottom: 10px;">5 GÃ¼nlÃ¼k Tahmin</div>
                                    <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px;">
                                        ${cityForecasts.slice(0, 8).map(forecast => {
                                            const forecastTime = new Date(forecast.forecast_time);
                                            const forecastTemp = forecast.temperature || 0;
                                            const forecastColor = getTemperatureColor(forecastTemp);
                                            return `
                                                <div style="min-width: 80px; text-align: center; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                                    <div style="font-size: 0.75em; color: #666; margin-bottom: 5px;">
                                                        ${forecastTime.toLocaleDateString('tr-TR', { month: 'short', day: 'numeric' })}
                                                    </div>
                                                    <div style="font-size: 0.7em; color: #999; margin-bottom: 5px;">
                                                        ${forecastTime.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })}
                                                    </div>
                                                    <div style="font-size: 1.1em; font-weight: bold; color: ${forecastColor}; margin-bottom: 3px;">
                                                        ${forecastTemp.toFixed(0)}Â°C
                                                    </div>
                                                    ${forecast.precipitation > 0 ? `
                                                        <div style="font-size: 0.7em; color: #3498db;">
                                                            ðŸ’§ ${forecast.precipitation.toFixed(1)}mm
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `;
                        }
                        
                        card.innerHTML = `
                            <div class="weather-city-header">
                                <div class="weather-city-name">${city}</div>
                                <div class="weather-city-temp" style="color: ${color};">${temp.toFixed(1)}Â°C</div>
                            </div>
                            <div class="weather-city-details">
                                <div class="weather-detail-item">
                                    <div class="weather-detail-label">RÃ¼zgar</div>
                                    <div class="weather-detail-value">${weather.wind_speed ? weather.wind_speed.toFixed(1) : '-'} m/s</div>
                                </div>
                                <div class="weather-detail-item">
                                    <div class="weather-detail-label">Nem</div>
                                    <div class="weather-detail-value">${weather.humidity || '-'}%</div>
                                </div>
                                <div class="weather-detail-item">
                                    <div class="weather-detail-label">Zaman</div>
                                    <div class="weather-detail-value" style="font-size: 0.85em;">${weather.time ? formatTime(weather.time) : '-'}</div>
                                </div>
                            </div>
                            ${forecastTimelineHTML}
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">Hava durumu verisi bulunamadÄ±</div>';
                }
            }).catch(error => {
                console.error('Hava durumu verisi yÃ¼kleme hatasÄ±:', error);
                document.getElementById('weatherWindowBody').innerHTML = 
                    '<div style="color: #999; text-align: center; padding: 40px;">Hava durumu verisi yÃ¼klenemedi</div>';
            });
        }

        function loadWeatherData() {
            fetch('/api/weather')
                .then(response => response.json())
                .then(data => {
                    // Haritadan sadece eski weather marker'larÄ± temizle (deprem marker'larÄ±na dokunma)
                    weatherMarkers.forEach(marker => map.removeLayer(marker));
                    weatherMarkers = [];
                    
                    // Haritaya yeni weather marker'larÄ± ekle
                    if (data.weather && data.weather.length > 0) {
                        data.weather.forEach(weather => {
                            addWeatherMarker(weather);
                        });
                    }
                })
                .catch(error => {
                    console.error('Hava durumu verisi yÃ¼kleme hatasÄ±:', error);
                });
        }

        // Alerts ve News yÃ¼kleme fonksiyonlarÄ±
        function loadAlerts() {
            Promise.all([
                fetch('/api/alerts/current').then(r => r.json()),
                fetch('/api/alerts/forecast').then(r => r.json())
            ]).then(([currentData, forecastData]) => {
                // Mevcut uyarÄ±lar - Hava Durumu ve Depremler olarak ayÄ±r
                const currentContainer = document.getElementById('alertsList');
                if (currentData.alerts && currentData.alerts.length > 0) {
                    currentContainer.innerHTML = '';
                    
                    // UyarÄ±larÄ± tÃ¼rlerine gÃ¶re ayÄ±r
                    const weatherAlerts = currentData.alerts.filter(a => a.type === 'weather');
                    const earthquakeAlerts = currentData.alerts.filter(a => a.type === 'earthquake');
                    
                    // Hava Durumu bÃ¶lÃ¼mÃ¼
                    if (weatherAlerts.length > 0) {
                        const header = document.createElement('div');
                        header.className = 'alert-section-header';
                        header.textContent = 'Hava Durumu';
                        currentContainer.appendChild(header);
                        
                        weatherAlerts.forEach(alert => {
                            const item = createAlertItem(alert);
                            currentContainer.appendChild(item);
                        });
                    }
                    
                    // Depremler bÃ¶lÃ¼mÃ¼
                    if (earthquakeAlerts.length > 0) {
                        const header = document.createElement('div');
                        header.className = 'alert-section-header';
                        header.textContent = 'Depremler';
                        currentContainer.appendChild(header);
                        
                        earthquakeAlerts.forEach(alert => {
                            const item = createAlertItem(alert);
                            currentContainer.appendChild(item);
                        });
                    }
                    
                    if (weatherAlerts.length === 0 && earthquakeAlerts.length === 0) {
                        currentContainer.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">Mevcut uyarÄ± bulunamadÄ±</div>';
                    }
                } else {
                    currentContainer.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">Mevcut uyarÄ± bulunamadÄ±</div>';
                }
                
                // Ä°leriye dÃ¶nÃ¼k uyarÄ±lar - Sadece Hava Durumu (deprem tahmini yok)
                const forecastContainer = document.getElementById('forecastAlertsList');
                if (forecastData.alerts && forecastData.alerts.length > 0) {
                    forecastContainer.innerHTML = '';
                    
                    // Ä°leriye dÃ¶nÃ¼k uyarÄ±lar sadece hava durumu
                    const header = document.createElement('div');
                    header.className = 'alert-section-header';
                    header.textContent = 'Hava Durumu Tahminleri';
                    forecastContainer.appendChild(header);
                    
                    forecastData.alerts.forEach(alert => {
                        const item = createAlertItem(alert);
                        forecastContainer.appendChild(item);
                    });
                } else {
                    forecastContainer.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">Ä°leriye dÃ¶nÃ¼k uyarÄ± bulunamadÄ±</div>';
                }
            }).catch(error => {
                console.error('Alert yÃ¼kleme hatasÄ±:', error);
                document.getElementById('alertsList').innerHTML = 
                    '<div style="color: #999; text-align: center; padding: 40px;">UyarÄ±lar yÃ¼klenemedi</div>';
                document.getElementById('forecastAlertsList').innerHTML = 
                    '<div style="color: #999; text-align: center; padding: 40px;">UyarÄ±lar yÃ¼klenemedi</div>';
            });
        }
        
        function createAlertItem(alert) {
            const item = document.createElement('div');
            item.className = `alert-item ${alert.severity}`;
            item.onclick = () => {
                // Alert'e gÃ¶re haritada konumu gÃ¶ster
                if (alert.data && alert.data.latitude && alert.data.longitude) {
                    map.setView([alert.data.latitude, alert.data.longitude], 8);
                } else if (alert.location) {
                    // Konum adÄ±ndan koordinat bulmaya Ã§alÄ±ÅŸ (basit)
                    console.log('Alert location:', alert.location);
                }
            };
            
            const date = new Date(alert.timestamp);
            
            item.innerHTML = `
                <div class="alert-header">
                    <div class="alert-title">${alert.title}</div>
                    <div class="alert-date">${date.toLocaleDateString('tr-TR')}</div>
                </div>
                <div class="alert-message">${alert.message}</div>
            `;
            return item;
        }

        function loadNews() {
            fetch('/api/news')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('newsList');
                    
                    // Badge gÃ¼ncelle (artÄ±k sol sidebar yok, bu kÄ±sÄ±m kaldÄ±rÄ±ldÄ±)
                    
                    if (data.news && data.news.length > 0) {
                        container.innerHTML = '';
                        data.news.forEach(news => {
                            const item = document.createElement('div');
                            item.className = 'news-item';
                            item.onclick = () => {
                                if (news.url) {
                                    window.open(news.url, '_blank');
                                }
                            };
                            
                            const date = new Date(news.time);
                            item.innerHTML = `
                                <div class="news-header">
                                    <div class="news-title">${news.title}</div>
                                    <span class="news-source">${news.source}</span>
                                </div>
                                <div class="news-time">${date.toLocaleDateString('tr-TR')} ${date.toLocaleTimeString('tr-TR')}</div>
                            `;
                            container.appendChild(item);
                        });
                    } else {
                        container.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">Haber bulunamadÄ±</div>';
                    }
                })
                .catch(error => {
                    console.error('News yÃ¼kleme hatasÄ±:', error);
                    document.getElementById('newsList').innerHTML = 
                        '<div style="color: #999; text-align: center; padding: 40px;">Haberler yÃ¼klenemedi</div>';
                });
        }

        // Filter ve Section fonksiyonlarÄ±
        let currentFilter = 'earthquakes'; // VarsayÄ±lan olarak Depremler sekmesi
        
        function filterContent(filter) {
            currentFilter = filter;
            
            // Tab'larÄ± gÃ¼ncelle
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Ä°Ã§eriÄŸi gÃ¶ster/gizle
            const earthquakeList = document.getElementById('earthquakeList');
            const alertsList = document.getElementById('alertsList');
            const newsList = document.getElementById('newsList');
            const forecastAlertsList = document.getElementById('forecastAlertsList');
            
            if (filter === 'earthquakes') {
                earthquakeList.style.display = 'block';
                alertsList.style.display = 'none';
                forecastAlertsList.style.display = 'none';
                newsList.style.display = 'none';
            } else if (filter === 'alerts') {
                earthquakeList.style.display = 'none';
                alertsList.style.display = 'block';
                forecastAlertsList.style.display = 'none';
                newsList.style.display = 'none';
            } else if (filter === 'forecast') {
                earthquakeList.style.display = 'none';
                alertsList.style.display = 'none';
                forecastAlertsList.style.display = 'block';
                newsList.style.display = 'none';
            } else if (filter === 'news') {
                earthquakeList.style.display = 'none';
                alertsList.style.display = 'none';
                forecastAlertsList.style.display = 'none';
                newsList.style.display = 'block';
            }
            
            // Scroll'u en Ã¼ste al
            if (earthquakeList.style.display === 'block') {
                earthquakeList.scrollTop = 0;
            }
            if (alertsList.style.display === 'block') {
                alertsList.scrollTop = 0;
            }
            if (forecastAlertsList.style.display === 'block') {
                forecastAlertsList.scrollTop = 0;
            }
            if (newsList.style.display === 'block') {
                newsList.scrollTop = 0;
            }
        }


        // Tarih gÃ¼ncelleme
        function updateDate() {
            const dateEl = document.getElementById('rightSidebarDate');
            if (dateEl) {
                const now = new Date();
                dateEl.textContent = now.toLocaleDateString('tr-TR', { 
                    day: '2-digit', 
                    month: 'long', 
                    year: 'numeric' 
                });
            }
        }

        function loadData() {
            fetch('/api/earthquakes')
                .then(response => response.json())
                .then(data => {
                    // Header istatistikler
                    document.getElementById('header-total').textContent = data.statistics.total;
                    document.getElementById('header-max').textContent = data.statistics.max_mag;

                    // Haritadan sadece eski deprem marker'larÄ± temizle (hava durumu marker'larÄ±na dokunma)
                    earthquakeMarkers.forEach(marker => map.removeLayer(marker));
                    earthquakeMarkers = [];
                    
                    // Deprem marker'larÄ±nÄ± haritaya ekle
                    data.earthquakes.forEach(eq => {
                        if (eq.latitude && eq.longitude) {
                            addEarthquakeMarker(eq);
                        }
                    });

                    // Deprem listesi - saÄŸ sidebar'a ekle
                    const container = document.getElementById('earthquakeList');
                    container.innerHTML = '<h2>Son Depremler</h2>';
                    
                    if (data.earthquakes && data.earthquakes.length > 0) {
                        data.earthquakes.forEach((eq, index) => {
                            const isStrong = eq.magnitude >= 5.0;
                            const item = document.createElement('div');
                            item.className = 'earthquake-item' + (isStrong ? ' strong' : '');
                            item.onclick = () => {
                                if (eq.latitude && eq.longitude) {
                                    map.setView([eq.latitude, eq.longitude], 8);
                                    // Ä°lgili marker'Ä± bul ve popup aÃ§
                                    earthquakeMarkers.forEach(marker => {
                                        const lat = marker.getLatLng().lat;
                                        const lng = marker.getLatLng().lng;
                                        if (Math.abs(lat - eq.latitude) < 0.1 && 
                                            Math.abs(lng - eq.longitude) < 0.1) {
                                            marker.openPopup();
                                        }
                                    });
                                }
                            };
                            item.innerHTML = `
                                <div class="eq-header">
                                    <span class="eq-magnitude ${isStrong ? 'strong' : ''}">${eq.magnitude.toFixed(1)}</span>
                                </div>
                                <div class="eq-location">${eq.location || 'Bilinmeyen'}</div>
                                <div class="eq-time">${formatTime(eq.timestamp)}</div>
                            `;
                            container.appendChild(item);
                        });
                    } else {
                        container.innerHTML += '<div style="color: #999; text-align: center; padding: 40px;">Deprem verisi bulunamadÄ±</div>';
                    }
                })
                .catch(error => {
                    console.error('Veri yÃ¼kleme hatasÄ±:', error);
                    const container = document.getElementById('earthquakeList');
                    if (container) {
                        container.innerHTML = '<div class="loading">Veri yÃ¼klenemedi. LÃ¼tfen Ã¶nce main_runtime.py Ã§alÄ±ÅŸtÄ±rÄ±n!</div>';
                    }
                });
        }

        // Sayfa yÃ¼klendiÄŸinde veriyi Ã§ek
        loadData();
        loadWeatherData();
        loadAlerts();
        loadNews();
        updateDate();
        initDraggable();

        // Her 30 saniyede bir otomatik yenile
        setInterval(() => {
            loadData();
            loadWeatherData();
            loadAlerts();
            loadNews();
            // EÄŸer weather window aÃ§Ä±ksa, iÃ§eriÄŸini de gÃ¼ncelle
            if (document.getElementById('weatherWindow').classList.contains('active')) {
                loadWeatherWindowData();
            }
        }, 30000);
    </script>
</body>
</html>
